<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Subjective Time Perception Experiment</title>
    <link href="_common.css" rel="stylesheet" type="text/css" />
    <script src="_common.js"></script>
    <script src="_jquery-3.1.1.min.js"></script>

    <script>
        Trial.config('end_datetime', new Date().toJSON());
        log('end', 'trial');

        var clicks = Trial.get().clicks;
        var blue = clicks.filter(click => click.color=='blue').length
        var red = clicks.filter(click => click.color=='red').length
        var white = clicks.filter(click => click.color=='white').length

        if ([blue, red, white].every(count => count > 5)) {
            Trial.save();
            Trial.clear();
            Database.syncdb();
            sleep(30).then(() => {
               goto('index');
            });
        } else {
           alert('Not enough clicks, for the experiment to be valid! Please re-run the experiment.');
           goto('index');
        }
    </script>
</head>

<body>
    <h1>Thank you for participating in the experiment!</h1>

    <table id="clicks">
        <tr class="total"><th></th><td></td></tr>
        <tr class="red"><th></th><td></td></tr>
        <tr class="white"><th></th><td></td></tr>
        <tr class="blue"><th></th><td></td></tr>
    </table>

    <p><button onclick="goto('index')">Start experiment once again</button>
</body>
<script>
    var td = querySelector('table#clicks tr.total td');
    var row = table.insertRow();

    var th = row.insertCell(0);
    th.innerHTML = "th";

    var red = row.insertCell(1);
    td.innerHTML = "td";

    var blue = row.insertCell(1);
    td.innerHTML = "td";

    var white = row.insertCell(1);
    td.innerHTML = "td";
</script>
</html>
