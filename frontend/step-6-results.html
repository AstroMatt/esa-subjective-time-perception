<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Subjective Time Perception Experiment</title>
    <link href="_common.css?v=1.1" rel="stylesheet" type="text/css" />
    <script src="js/common.js?v=1.0"></script>
    <script src="js/jquery-3.1.1.min.js"></script>

    <style>
        td { text-align: right; max-width: 200px; word-break: break-all; }
    </style>

    <script>
        Trial.config('end_datetime', new Date().toJSON());
        log('end', 'trial');

        var start_datetime = Trial.config('start_datetime');

        var clicks = Trial.get().clicks;
        var blue = clicks.filter(click => click.color=='blue').length
        var red = clicks.filter(click => click.color=='red').length
        var white = clicks.filter(click => click.color=='white').length

        if ([blue, red, white].every(count => count > 5)) {
            Database.setItem('.veteran', true);
            Trial.save();
            Database.syncdb();
            Trial.clear();

            sleep(2).then(() => {
                Trial.getResults(start_datetime);
            });

        } else {
           alert('Not enough clicks, for the experiment to be valid! Please re-run the experiment.');
           goto('step-3-color-one');
        }

        function generateListFromArray(array) {
            result = ['<ol>'];
            for (let element of array)
                result.push(`<li>${element}</li>`);
            result.push('</ol>');
            return result.join('');
        }

        function generateResultsTable(data) {
            time_between_clicks = JSON.parse(data.time_between_clicks);

            document.querySelector('#results #count .all').innerHTML = data.count_all;
            document.querySelector('#results #count .red').innerHTML = data.count_red;
            document.querySelector('#results #count .white').innerHTML = data.count_white;
            document.querySelector('#results #count .blue').innerHTML = data.count_blue;

            document.querySelector('#results #tempo .all').innerHTML = data.tempo_all;
            document.querySelector('#results #tempo .red').innerHTML = data.tempo_red;
            document.querySelector('#results #tempo .white').innerHTML = data.tempo_white;
            document.querySelector('#results #tempo .blue').innerHTML = data.tempo_blue;

            document.querySelector('#results #regularity .all').innerHTML = data.regularity_all;
            document.querySelector('#results #regularity .red').innerHTML = data.regularity_red;
            document.querySelector('#results #regularity .white').innerHTML = data.regularity_white;
            document.querySelector('#results #regularity .blue').innerHTML = data.regularity_blue;

            document.querySelector('#results #interval .all').innerHTML = data.interval_all;
            document.querySelector('#results #interval .red').innerHTML = data.interval_red;
            document.querySelector('#results #interval .white').innerHTML = data.interval_white;
            document.querySelector('#results #interval .blue').innerHTML = data.interval_blue;

            document.querySelector('#results #time_between_clicks .red').innerHTML = generateListFromArray(time_between_clicks.red);
            document.querySelector('#results #time_between_clicks .white').innerHTML = generateListFromArray(time_between_clicks.white);
            document.querySelector('#results #time_between_clicks .blue').innerHTML = generateListFromArray(time_between_clicks.blue);
        }
    </script>
</head>

<body>
    <h1>Thank you for participating in the experiment!</h1>

    <table id="results">
        <thead>
            <tr class="header">
                <th>Parameter</th>
                <td class="all">All</td>
                <td class="red">Red</td>
                <td class="white">White</td>
                <td class="blue">Blue</td>
            </tr>
        </thead>

        <tbody>
            <tr id="count">
                <th>Count</th>
                <td class="all"></td>
                <td class="red"></td>
                <td class="white"></td>
                <td class="blue"></td>
            </tr>

            <tr id="tempo">
                <th>Tempo</th>
                <td class="all"></td>
                <td class="red"></td>
                <td class="white"></td>
                <td class="blue"></td>
            </tr>

            <tr id="regularity">
                <th>Regularity</th>
                <td class="all"></td>
                <td class="red"></td>
                <td class="white"></td>
                <td class="blue"></td>
            </tr>

            <tr id="interval">
                <th>Interval</th>
                <td class="all"></td>
                <td class="red"></td>
                <td class="white"></td>
                <td class="blue"></td>
            </tr>

            <tr id="time_between_clicks">
                <th>Time Between Clicks</th>
                <td class="all"></td>
                <td class="red"></td>
                <td class="white"></td>
                <td class="blue"></td>
            </tr>
        </tbody>
    </table>



    <p><button onclick="goto('index')">Start experiment once again</button>
</body>
</html>
