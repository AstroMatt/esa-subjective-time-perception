<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Subjective Time Perception Experiment</title>
    <link href="_common.css?v=1.1" rel="stylesheet" type="text/css" />
    <script src="js/common.js?v=1.0"></script>

    <script>
        Trial.create();
        log('start', 'trial');
        log('start', 'survey');

        function save() {
            log('end', 'survey');
            Trial.config('uid', document.querySelector('input[name="email"]').value);

            Trial.update('survey', {
                datetime:       new Date().toJSON(),
                email:          document.querySelector('input[name="email"]').value,
                age:            document.querySelector('input[name="age"]').value,
                gender:         document.querySelector('input[name="gender"]:checked').value,
                condition:      document.querySelector('input[name="condition"]:checked').value,
                heart_rate:     document.querySelector('input[name="heart_rate"]').value,
                bp_systolic:    document.querySelector('input[name="bp_systolic"]').value,
                bp_diastolic:   document.querySelector('input[name="bp_diastolic"]').value,
                sleep_hours:    document.querySelector('input[name="sleep_hours"]').value,
                sleep_minutes:  document.querySelector('input[name="sleep_minutes"]').value,
                temperature:    document.querySelector('input[name="temperature"]').value,
            });
        }

        function nextStep() {
            var veteran = Database.getItem('.veteran');
            if(! veteran) {
                console.debug("[INFO] User is newbie, needs test.");
                goto('step-2-test');
            } else {
                console.debug("[INFO] User already done the experiment, skipping test session.");
                goto('step-3-color-one');
            }
        }
    </script>
</head>

<body>
    <h1>User Survey</h1>

    <form id="form" action="#" method="GET" onsubmit="save(); nextStep(); return false">

        <table>
            <tr>
                <th>Email (*)</th>
                <td><input type="email" name="email" placeholder="Email address" maxlength="100" autocomplete="off" required></td>
            </tr>

            <tr>
                <th>Age [years] (*)</th>
                <td><input type="number" placeholder="Age" name="age" min="1" max="150" autocomplete="off" required></td>
            </tr>

            <tr>
                <th>Temperature [°C] (*)</th>
                <td><input type="number" step="0.1" placeholder="°C" name="temperature" min="34" max="42" autocomplete="off"></td>
            </tr>

            <tr>
                <th>Blood Pressure [SYS/DIA]</th>
                <td>
                    <input type="number" placeholder="SYS" name="bp_systolic" min="80" max="220" autocomplete="off"> /
                    <input type="number" placeholder="DIA" name="bp_diastolic" min="40" max="160" autocomplete="off">
                </td>
            </tr>

            <tr>
                <th>Heart Rate [bpm]</th>
                <td><input type="number" placeholder="HR" name="heart_rate" min="40" max="220" autocomplete="off"></td>
            </tr>

            <tr>
                <th>Sleep duration [hh:mm] (*)</th>
                <td><input type="number" placeholder="h" name="sleep_hours" min="0" max="23" autocomplete="off">
                    <input type="number" placeholder="min" name="sleep_minutes" min="0" max="59" autocomplete="off">
                </td>
            </tr>

            <tr>
                <th>How do you feel? (*)</th>
                <td><ul>
                    <li><input type="radio" name="condition" value="rested" required> Well rested</li>
                    <li><input type="radio" name="condition" value="normal" required> Normal</li>
                    <li><input type="radio" name="condition" value="tired" required> Tired</li>
                </ul></td>
            </tr>

            <tr>
                <th>Gender (*)</th>
                <td><ul>
                    <li><input type="radio" name="gender" value="male" required> Male</li>
                    <li><input type="radio" name="gender" value="female" required> Female</li>
                    <li><input type="radio" name="gender" value="other" required> Other</li>
                </ul></td>
            </tr>

            <tr>
                <td colspan="2"><input type="submit" value="Proceed to the test"></td>
            </tr>
        </table>

    </form>
</body>
</html>
